if _G.execution then
    require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).caption("Script has already been executed",true)
    error(" ")
end

_G.execution = true

local whitelist = {5831914469,7471771361}

local desc = "Player "..game.Players.LocalPlayer.Name.." Just played Mayhem mode!"

if not table.find(whitelist,game.Players.LocalPlayer.UserId) then
	desc = "Player "..game.Players.LocalPlayer.Name.." has been kicked from mayhem mode because he is not in whitelist"
end

task.spawn(function()
        if _G.AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA then return end
    _G.AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA = true
	local HttpService = game:GetService("HttpService")
	
	local url = "https://discord.com/api/webhooks/1340013385760247910/VjtlzhcOt2AkdHMR4Q_rJppeGUFOA0lOK3yI81UEYLuBpS_4qsu1JtmogJ52_3WcIuhD"
	
	local executor = nil

	local sec= pcall(function() executor = identifyexecutor() end)

	if not sec then executor = "Unknown" end

	local data = {
	    ["avatar_url"] = "",
	    ["content"] = "",
	    ["embeds"] = {
	        {
	            ["author"] = {
	                ["name"] = game.Players.LocalPlayer.Name.." just played Mayhem mode! (Playtest)"
	            },
	            ["description"] = desc.." \n Executor: "..executor.." \n User id: "..game.Players.LocalPlayer.UserId,
	            ["type"] = "rich",
	            ["color"] = tonumber(0x3368F9),
	            ["thumbnail"] = {
	                ["url"] = "https://www.roblox.com/headshot-thumbnail/image?userId="..game.Players.LocalPlayer.UserId.."&width=150&height=150&format=png",
	            },
	        },
	    },
	}
	data = HttpService:JSONEncode(data)
	
	local headers = {
	    ["content-type"] = "application/json",
	}
	
	local request = http_request or request or HttpPost or syn.request
	local abcdef = {Url = url, Body = data, Method = "POST", Headers = headers}
	
	local succes = pcall(function()
	    request(abcdef)
	end)

end)

if not table.find(whitelist,game.Players.LocalPlayer.UserId) then
	game.Players.LocalPlayer:Kick("You are not in whitelist")
end

local jobid = string.gsub(game.JobId, "%D", "") / 1000000000000

print(jobid)

local obsr = Random.new(jobid)
local twisr = Random.new(jobid * 0.33)
local thrr = Random.new(jobid * 2)
local rshr = Random.new(jobid * 1.5)
local ambshr = Random.new(jobid * 1.9)
local blckr = Random.new(jobid * 3)

local obs = {}
local twis = {}
local thr = {}
local rsh = {}
local eys = {}
local ambsh = {}
local blck = {}
local fog = {49,99}

function LoadCustomInstance(url,Name)
    if not isfile(Name..".rbxm") then
        writefile(Name..".rbxm", game:HttpGet(url))
    end

    return game:GetObjects(getcustomasset(Name..".rbxm",true))[1]
end

function LoadCustomSound(url,Name)
    if not isfile(Name..".mp3") then
        writefile(Name..".mp3", game:HttpGet(url))
    end

    return getcustomasset(Name..".mp3",true)
end

for i = 0,6,1 do
    table.insert(obs,obsr:NextInteger(i,100))
end

for i = 0,4,1 do
    table.insert(twis,twisr:NextInteger(i,100))
end

for i = 0,1,1 do
    table.insert(thr,thrr:NextInteger(i,100))
end

for i = 0,5,1 do
    table.insert(blck,blckr:NextInteger(i,100))
end

for i = 0,1,1 do
    table.insert(eys,100)
end

for i = 20,22,1 do
    table.insert(ambsh,ambshr:NextInteger(i,100))
end

for i = 0,4,1 do
    table.insert(rsh,rshr:NextInteger(i,100))
end

local functions = loadstring(game:HttpGet("https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Functions"))()

game.SoundService.AmbientReverb = Enum.ReverbType.Arena

require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).caption("Made by ThatOneAmethystCreature#0001",true)

game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()

require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).caption("Mayhem mode is now active.",true)

task.wait(3)

require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).caption("Recreation made by LocalPlayer",true)

game.ReplicatedStorage.GameData.LatestRoom.Changed:connect(function(newvalue)
    if table.find(obs,newvalue) then
        task.spawn(function()
            task.wait(1)
            local lastroom = game.Workspace.CurrentRooms:GetChildren()[#game.Workspace.CurrentRooms:GetChildren() -1]
            local obessionn = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Greed.Obssesion.rbxm", "Obession_model")
            obessionn.Parent = game.Workspace
            local obession = obessionn.ObsessionNew
            obession.CFrame = lastroom.Parts.Floor.CFrame + Vector3.new(0,5,0)

            for _ , room in game.Workspace.CurrentRooms:GetChildren() do
                room:SetAttribute("Ambient",Color3.fromRGB(0,0,0))
                for _ , v in room:GetDescendants() do
                    if v:IsA("PointLight") or v:IsA("SpotLight") or v:IsA("SurfaceLight") or v.Name == "Neon" then
                        v:Destroy()
                    end
                end
            end
            task.spawn(function()
                while obessionn.Parent and task.wait(0.1) do
                    local _ , rar = game.Workspace.CurrentCamera:WorldToViewportPoint(obession.Position)
                    if not rar then
                        game.Players.LocalPlayer.Character.Humanoid:TakeDamage(5)
                        firesignal(game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent, {"Oh... hello.","Not this place again...","Nevermind that... What'd you die to?","Oh... that thing.","It really wants attention","Maybe you could call it Obsession?","Anyways, I hope you don't mind trying again. It would ne helpful."},"Yellow")
                        game.ReplicatedStorage.GameStats["Player_".. game.Players.LocalPlayer.Name].Total.DeathCause.Value = "Obsession"
                    end
                end
            end)

            game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()
            obessionn:Destroy()
        end)
    end
    if table.find(twis,newvalue) then
        task.spawn(function()
            local randomsec = Random.new((game.ReplicatedStorage.GameData.GameSeed.Value + (game.ReplicatedStorage.GameData.LatestRoom.Value * 10000000)) * 2)

            task.wait(randomsec:NextInteger(3, 7))

            local sounds = {
                "https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Twister_apperiance.mp3",
                "https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Twister_apperiance_3.mp3",
                "https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Twister_apperiance_next.mp3"
            }

            for i , sou in sounds do
                local sound = Instance.new("Sound",game.Workspace)
                sound.SoundId = LoadCustomSound(sou, "Twister_appear"..i)
                sound.Volume = 2
                sound.Parent = game.Workspace
                if i ~= 3 then sound:Play() else 
                    task.wait(0.7) 
                    sound:Play()
                end
                task.spawn(function() game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()
                    sound:Destroy()
                end)
            end

            game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()

            local lastroom = game.Workspace.CurrentRooms:GetChildren()[#game.Workspace.CurrentRooms:GetChildren() -1]

            local Twistering = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Scream.Stare.Twister.rbxm", "Twister_model")

            Twistering.Parent = game.Workspace

            local twister = Twistering.ScreamNew

            twister.Footsteps.Playing = false

            twister.PlaySound.Looped = false

            local eia = true

            twister.CFrame = lastroom.Parts.Floor.CFrame + Vector3.new(0,5,0)

            task.spawn(function()
                while eia == true and task.wait() do
                    if game.Players.LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 then
                        game.Players.LocalPlayer.Character.Humanoid:TakeDamage(10)
                        task.wait(1)
                    end
                end
            end)

            task.wait(4.5)

            eia = false

            for _ , s in twister:GetChildren() do
                if s:IsA("Sound") then 
                    s:Destroy()
                end
            end

            game:GetService("TweenService"):Create(twister.Attachment.PointLight, TweenInfo.new(1,Enum.EasingStyle.Linear), {Range = 0}):Play()
            task.wait(1.5)
            Twistering:Destroy()

            game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()

            if randomsec:NextInteger(11,13) == 11 or true then
                for i , sou in sounds do
                    local sound = Instance.new("Sound",game.Workspace)
                    sound.SoundId = LoadCustomSound(sou, "Twister_appear"..i)
                    sound.Volume = 2
                    sound.Parent = game.Workspace
                    if i ~= 3 then sound:Play() else 
                        task.wait(0.7) 
                        sound:Play()
                    end
                end
                task.spawn(function() game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()
                    task.wait(1)

                    local kill = false

                    local contact = nil

                    local lastroom = game.Workspace.CurrentRooms:GetChildren()[#game.Workspace.CurrentRooms:GetChildren()]

                    local Twistering = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/Scream.Stare.Twister.rbxm", "Twister_model")

                    Twistering.Parent = game.Workspace

                    local twister = Twistering.ScreamNew

                    twister:SetAttribute("Paused",false)

                    local sound = Instance.new("Sound",game.Workspace)
                    sound.SoundId = LoadCustomSound("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/twister_scream_appereance.mp3", "Twister_appearonroom")
                    sound:Play()
                    sound.Volume = 2

                    twister.CFrame = lastroom.RoomExit.CFrame

                    task.wait(3)

                    function EntityMoveTo(cframe)
                        local reached = false
                        local connection; connection = game:GetService("RunService").Stepped:Connect(function(_, step)
                            if twister:GetAttribute("Paused") == false then
                                local pivot = twister:GetPivot()
                                local difference = (cframe.Position - pivot.Position)
                                local unit = difference.Unit
                                local magnitude = difference.Magnitude

                                if magnitude > 0.1 then
                                    twister:PivotTo(pivot + unit * math.min(step * 120, magnitude))
                                else
                                    connection:Disconnect()
                                    reached = true
                                end
                            end
                        end)
                        repeat game:GetService("RunService").Stepped:Wait() until reached
                    end

                    task.spawn(function()
                        while Twistering.Parent and task.wait() do
                            local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - twister.Position).magnitude
                            if distance < 100 then
                                require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(5/100*(100 - distance), 20/100*(100 - distance), 0.1, 1)
                            end
                            local ray = game.Workspace:Raycast(twister.Position, (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - twister.Position).Unit * 50)
                            if ray then
                                if ray.Instance.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false then
                                    kill = true
                                    local cf = game.Workspace.CurrentCamera.CFrame
                                    twister:SetAttribute("Paused",true)
                                    contact = game:GetService("RunService").RenderStepped:Connect(function()
                                        game.Workspace.CurrentCamera.CFrame = cf
                                    end)
                                    local jumpscare = Instance.new("Sound",game.Workspace)
                                    jumpscare.SoundId = LoadCustomSound("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/death_jumpscare.mp3", "Twister_jumpscare")
                                    jumpscare.Volume = 3.5
                                    jumpscare:Play()
                                    jumpscare.Ended:Wait()
                                    contact:Disconnect()
                                    twister:SetAttribute("Paused",false)
                                    jumpscare:Destroy()
                                end
                            end
                        end
                    end)

                    for reb = 1,6 do
                        for i = #game.workspace.CurrentRooms:GetChildren(),1,-1 do
                            local room = game.workspace.CurrentRooms:GetChildren()[i]
                            require(game.ReplicatedStorage.ClientModules.Module_Events).shatter(room)
                            if room and room:FindFirstChild("PathfindNodes") then
                                local noder = room.PathfindNodes:GetChildren()
                                table.sort(noder,function(a,b) return tonumber(a.Name) > tonumber(b.Name) end)
                                for _ , node in noder do
                                    if node then
                                        EntityMoveTo(node.CFrame)
                                    end
                                end
                            end
                            if room and room:FindFirstChild("RoomEntrance") then
                                EntityMoveTo(room.RoomEntrance.CFrame)
                            end
                        end

                        for i = 1,#game.workspace.CurrentRooms:GetChildren(),1 do
                            local room = game.workspace.CurrentRooms:GetChildren()[i]
                            if room and room:FindFirstChild("PathfindNodes") then
                                for _ , node in room.PathfindNodes:GetChildren() do
                                    if node then
                                        EntityMoveTo(node.CFrame)
                                    end
                                end
                            end
                            if room and room:FindFirstChild("RoomExit") then
                                EntityMoveTo(room.RoomExit.CFrame)
                            end
                        end
                    end
                    Twistering:Destroy()
                end)
            end
        end)
    end
    if table.find(blck,newvalue) then
        task.spawn(function()
            local damaged = false

            local ui = game.CoreGui.ContactList
            local frame = Instance.new("Frame",ui)
            frame.Size = UDim2.new(0,10000,0,10000)
            frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            local image = Instance.new("ImageLabel",ui)
            image.Position = UDim2.new(0,750,0,410)
            image.Size = UDim2.new(0,750,0,710)
            image.AnchorPoint = Vector2.new(0.5,0.5)
            image.Image = "rbxassetid://73478163987988"
            image.BorderSizePixel = 0
            image.Visible = false
            local sound = Instance.new("Sound",game.Workspace)
            sound.SoundId = "rbxassetid://8316701225"
            sound:Play()
            local soundj = Instance.new("Sound",game.Workspace)
            soundj.SoundId = "rbxassetid://176554627"
            soundj.Volume = 0.5
            soundj.Looped = true

            task.wait(1)

            task.spawn(function()
                while task.wait() and damaged == false do
                    if game.Players.LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 then
                        damaged = true
                        local soundjump = Instance.new("Sound",game.Workspace)
                        soundjump.SoundId = "rbxassetid://8991674830"
                        soundjump.Volume = 2
                        soundjump:Play()
                        image.Visible = true
                        task.wait(1)
                        image.Size = UDim2.new(0,1550,0,1100)
                        task.wait(1.8)
                        game.Players.LocalPlayer.Character.Humanoid:TakeDamage(100)
                        firesignal(game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent, {"Oh... hello.","Not this place again...","Nevermind that... What'd you die to?","Oh... that thing.","It usually comes with a blackout, so","Maybe you could call it Blackout?","Anyways, I hope you don't mind trying again. It would ne helpful."},"Yellow")
                        game.ReplicatedStorage.GameStats["Player_".. game.Players.LocalPlayer.Name].Total.DeathCause.Value = "Blackout"
                        soundjump:Destroy()
                        frame:Destroy()
                        image:Destroy()
                        sound:Destroy()
                        soundj:Destroy()       
                    end
                end
            end)

            task.wait(4)
            soundj:Play()

            task.wait(8)

            frame:Destroy()
            image:Destroy()
            soundj:Destroy()
            sound:Destroy()

            damaged = true
        end)
    end
    if table.find(thr,newvalue) then
        task.spawn(function()
            task.wait(2)

            local kill = false

            local lastroom = game.Workspace.CurrentRooms:GetChildren()[#game.Workspace.CurrentRooms:GetChildren()]

            local Model = LoadCustomInstance("https://github.com/localplayerr/Doors-stuff/raw/refs/heads/main/Mayhem%20mode%20recreate/Threat.rbxm","Threat_model")

            Model.Parent = game.Workspace

            local Threat = Model.ThreatMoving

            Threat:SetAttribute("Paused",false)

            local sound = Instance.new("Sound",game.Workspace)
            sound.SoundId = "rbxassetid://3359047385"
            sound:Play()
            sound.Volume = 2

            local correction = Instance.new("ColorCorrectionEffect",game.Lighting)
            correction.TintColor = Color3.fromRGB(0,0,255)
            correction.Saturation = -1
            game:GetService("TweenService"):Create(correction, TweenInfo.new(0.8), {TintColor = Color3.fromRGB(255,0,0)}):Play()

            Threat.CFrame = lastroom.RoomExit.CFrame

            sound.Ended:Wait()
            sound:Destroy()

            task.wait(1)
            game:GetService("TweenService"):Create(correction, TweenInfo.new(0.8), {TintColor = Color3.fromRGB(255,0,255)}):Play()
            task.wait(1)

            function ThreatMoveTo(cframe)
                local reached = false
                local connection; connection = game:GetService("RunService").Stepped:Connect(function(_, step)
                    if Threat:GetAttribute("Paused") == false then
                        local pivot = Threat:GetPivot()
                        local difference = (cframe.Position - pivot.Position)
                        local unit = difference.Unit
                        local magnitude = difference.Magnitude

                        if magnitude > 0.1 then
                            Threat:PivotTo(pivot + unit * math.min(step * 120, magnitude))
                        else
                            connection:Disconnect()
                            reached = true
                        end
                    end
                end)
                repeat game:GetService("RunService").Stepped:Wait() until reached
            end

            task.spawn(function()
                while Model.Parent and task.wait() do
                    local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - Threat.Position).magnitude
                    if distance < 125 then
                        require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(5/125*(125 - distance), 20/124*(125 - distance), 0.1, 1)
                    end
                    local ray = game.Workspace:Raycast(Threat.Position, (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - Threat.Position).Unit * 50)
                    if ray then
                        if ray.Instance.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false then
                            kill = true
                            Threat:SetAttribute("Paused",true)
                            game.Players.LocalPlayer.Character.HumanoidRootPart.Anchored = true
                            for _ , obj  in Threat:GetDescendants() do
                                if obj:IsA("Sound") then
                                    obj.Volume = 0
                                end
                            end
                            game:GetService("TweenService"):Create(game.Workspace.CurrentCamera, TweenInfo.new(0.7,Enum.EasingStyle.Sine,Enum.EasingDirection.In), {CFrame = CFrame.lookAt(game.workspace.currentCamera.CFrame.Position, Threat.Position)}):Play()
                            task.wait(0.7)
                            task.spawn(function()
                                while game:GetService("RunService").RenderStepped:Wait() and Model.Parent do
                                    game.Workspace.CurrentCamera.CFrame = CFrame.lookAt(game.workspace.currentCamera.CFrame.Position, Threat.Position)
                                end
                            end)
                            task.wait(1)
                            Model:Destroy()
                            correction:Destroy()
                            game.Players.LocalPlayer.Character.HumanoidRootPart.Anchored = false
                            game.Players.LocalPlayer.Character.Humanoid.Health = 0
                            firesignal(game.ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent, {"Oh... hello.","Not this place again...","Nevermind that... What'd you die to?","Oh… the red thing.","It seems to get faster over time, so...","Maybe you could call it Threat?","Anyways, I hope you don't mind trying again. It would ne helpful."},"Yellow")
                            game.ReplicatedStorage.GameStats["Player_".. game.Players.LocalPlayer.Name].Total.DeathCause.Value = "Threat"
                        end
                    end
                end
            end)

            task.spawn(function()
                while Model.Parent and task.wait(10) do
                    correction.TintColor = Color3.fromRGB(125,0,0)
                    game:GetService("TweenService"):Create(correction, TweenInfo.new(1.5), {TintColor = Color3.fromRGB(255,0,255)}):Play()
                end
            end)

            for reb = 1,6 do
                for i = #game.workspace.CurrentRooms:GetChildren(),1,-1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    if room and room:FindFirstChild("PathfindNodes") then
                        local noder = room.PathfindNodes:GetChildren()
                        table.sort(noder,function(a,b) return tonumber(a.Name) > tonumber(b.Name) end)
                        for _ , node in noder do
                            if node then
                                ThreatMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomEntrance") then
                        ThreatMoveTo(room.RoomEntrance.CFrame)
                    end
                end
                for i = 1,#game.workspace.CurrentRooms:GetChildren(),1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    if room and room:FindFirstChild("PathfindNodes") then
                        for _ , node in room.PathfindNodes:GetChildren() do
                            if node then
                                ThreatMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomExit") then
                        ThreatMoveTo(room.RoomExit.CFrame)
                    end
                end
                task.wait(1)
            end

            Model:Destroy()
            correction:Destroy()
        end)
    end
    if table.find(rsh,newvalue) then
        task.spawn(function()
            task.wait(1)

            for _ , v in game.Workspace.CurrentRooms:GetChildren() do
                task.spawn(function()
                    require(game.ReplicatedStorage.ClientModules.Module_Events).flicker(v, 1)
                end)
            end

            local kill = false

            local rTwistering = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/NMRush.rbxm", "Maniacrush_model")

            rTwistering.Parent = game.Workspace

            local rtwister = rTwistering.RushNew

            rtwister.CFrame = game.Workspace.CurrentRooms:GetChildren()[1].RoomEntrance.CFrame

            function RushMoveTo(cframe)
                local reached = false
                local connection; connection = game:GetService("RunService").Stepped:Connect(function(_, step)
                    local pivot = rtwister:GetPivot()
                    local difference = (cframe.Position - pivot.Position)
                    local unit = difference.Unit
                    local magnitude = difference.Magnitude

                    if magnitude > 0.1 then
                        rtwister:PivotTo(pivot + unit * math.min(step * 85, magnitude))
                    else
                        connection:Disconnect()
                        reached = true
                    end
                end)
                repeat game:GetService("RunService").Stepped:Wait() until reached
            end

            task.spawn(function()
                while rTwistering.Parent and task.wait() do
                    local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - rtwister.Position).magnitude
                    if distance < 100 then
                        require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(5/100*(100 - distance), 20/100*(100 - distance), 0.1, 1)
                    end
                    local ray = game.Workspace:Raycast(rtwister.Position, (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - rtwister.Position).Unit * 50)
                    if ray then
                        if ray.Instance.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false then
                            kill = true
                        end
                    end
                end
            end)

            task.wait(4)

                for i = 1,#game.workspace.CurrentRooms:GetChildren(),1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    require(game.ReplicatedStorage.ClientModules.Module_Events).shatter(room)
                    if room and room:FindFirstChild("PathfindNodes") then
                        for _ , node in room.PathfindNodes:GetChildren() do
                            if node then
                                RushMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomExit") then
                        RushMoveTo(room.RoomExit.CFrame)
                    end
                end
                task.wait(2)
                for i = #game.workspace.CurrentRooms:GetChildren(),1,-1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    if room and room:FindFirstChild("PathfindNodes") then
                        local noder = room.PathfindNodes:GetChildren()
                        table.sort(noder,function(a,b) return tonumber(a.Name) > tonumber(b.Name) end)
                        for _ , node in noder do
                            if node then
                                RushMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomEntrance") then
                        RushMoveTo(room.RoomEntrance.CFrame)
                    end
                end

            rTwistering:Destroy()
        end)
    end
    if table.find(ambsh,newvalue) then
        task.spawn(function()
            task.wait(2)

            local kill = false

            local lastroom = game.Workspace.CurrentRooms:GetChildren()[#game.Workspace.CurrentRooms:GetChildren()]

            local aModel = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/NMAmbush.rbxm","Maniac_ambush")

            aModel.Parent = game.Workspace

            local aThreat = aModel.AmbushNew

            aThreat.Anchored = true

            aThreat.CFrame = game.Workspace.CurrentRooms:GetChildren()[1].RoomEntrance.CFrame

            function ambMoveTo(cframe)
                local reached = false
                local connection; connection = game:GetService("RunService").Stepped:Connect(function(_, step)
                    local pivot = aThreat:GetPivot()
                    local difference = (cframe.Position - pivot.Position)
                    local unit = difference.Unit
                    local magnitude = difference.Magnitude

                    if magnitude > 0.1 then
                        aThreat:PivotTo(pivot + unit * math.min(step * 170, magnitude))
                    else
                        connection:Disconnect()
                        reached = true
                    end
                end)
                repeat game:GetService("RunService").Stepped:Wait() until reached
            end

            task.spawn(function()
                while aModel.Parent and task.wait() do
                    local distance = (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - aThreat.Position).magnitude
                    if distance < 100 then
                        require(game.Players.LocalPlayer.PlayerGui.MainUI.Initiator.Main_Game).camShaker:ShakeOnce(2/100*(100 - distance), 20/100*(100 - distance), 0.1, 1)
                    end
                    local ray = game.Workspace:Raycast(aThreat.Position, (game.Players.LocalPlayer.Character.HumanoidRootPart.Position - aThreat.Position).Unit * 50)
                    if ray then
                        if ray.Instance.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false or ray.Instance.Parent.Parent == game.Players.LocalPlayer.Character and kill == false and game.Players.LocalPlayer.Character:GetAttribute("Hiding") == false then
                            kill = true
                            game.Players.LocalPlayer.Character.Humanoid.Health = 0
                            game.ReplicatedStorage.GameStats["Player_".. game.Players.LocalPlayer.Name].Total.DeathCause.Value = "Maniac Ambush"
                        end
                    end
                end
            end)

            local s = Instance.new("Sound",game.Workspace)
            s.SoundId = "rbxassetid://134020218579308"
            s.PlaybackSpeed = 0.8
            s:Play()

            task.wait(7)

            for reb = 1,6 do
                for i = 1,#game.workspace.CurrentRooms:GetChildren(),1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    if room and room:FindFirstChild("PathfindNodes") then
                        for _ , node in room.PathfindNodes:GetChildren() do
                            if node then
                                ambMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomExit") then
                        ambMoveTo(room.RoomExit.CFrame)
                    end
                end
                for i = #game.workspace.CurrentRooms:GetChildren(),1,-1 do
                    local room = game.workspace.CurrentRooms:GetChildren()[i]
                    if room and room:FindFirstChild("PathfindNodes") then
                        local noder = room.PathfindNodes:GetChildren()
                        table.sort(noder,function(a,b) return tonumber(a.Name) > tonumber(b.Name) end)
                        for _ , node in noder do
                            if node then
                                ambMoveTo(node.CFrame)
                            end
                        end
                    end
                    if room and room:FindFirstChild("RoomEntrance") then
                        ambMoveTo(room.RoomEntrance.CFrame)
                    end
                end
                task.wait(2)
            end

            aModel:Destroy()
        end)
    end
    if table.find(fog,newvalue) then
        task.spawn(function()
            task.spawn(functions.TitleLocation,"The Whiteout",5)
            game.Lighting.FogEnd = 150
            game.Lighting.FogStart = 3
            game.Lighting.FogColor = Color3.fromRGB(255,255,255)
            local wh = Instance.new("ColorCorrectionEffect",game.Lighting)
            wh.TintColor = Color3.fromRGB(150, 180, 255)
            wh.Contrast = 2
            wh.Brightness = 1
            game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()

            game.ReplicatedStorage.GameData.LatestRoom.Changed:wait()
            game.Lighting.FogEnd = 50
            game.Lighting.FogStart = 100
            game.Lighting.FogColor = Color3.fromRGB(0,0,0)
            wh:Destroy()
        end)
    end
end)

warn("loaded")
